<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TanziTech Admin Dashboard</title>
    <link rel="stylesheet" href="auth-styles.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }
        
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .dashboard-header {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-card {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: #2563eb;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .user-list {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .user-list-header {
            background: #f8fafc;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .user-item {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }
        
        .user-details {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .membership-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-free {
            background: #f3f4f6;
            color: #4b5563;
        }
        
        .badge-premium {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge-pro {
            background: #ecfdf5;
            color: #065f46;
        }
        
        .email-queue {
            margin-top: 2rem;
        }
        
        .queue-item {
            padding: 1rem 2rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }
        
        .queue-status {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-scheduled {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-sent {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-failed {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .refresh-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .refresh-btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <h1>ðŸš€ TanziTech Admin Dashboard</h1>
            <p>Monitor user registrations, email automation, and engagement metrics</p>
            <button class="refresh-btn" onclick="refreshDashboard()">Refresh Data</button>
        </header>
        
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="stat-number" id="total-users">-</div>
                <div class="stat-label">Total Registered Users</div>
            </div>
            
            <div class="dashboard-card">
                <div class="stat-number" id="active-subscribers">-</div>
                <div class="stat-label">Active Email Subscribers</div>
            </div>
            
            <div class="dashboard-card">
                <div class="stat-number" id="premium-members">-</div>
                <div class="stat-label">Premium Members</div>
            </div>
            
            <div class="dashboard-card">
                <div class="stat-number" id="conversion-rate">-%</div>
                <div class="stat-label">Free to Premium Conversion</div>
            </div>
            
            <div class="dashboard-card">
                <div class="stat-number" id="emails-sent">-</div>
                <div class="stat-label">Total Emails Sent</div>
            </div>
            
            <div class="dashboard-card">
                <div class="stat-number" id="avg-engagement">-</div>
                <div class="stat-label">Average Engagement Score</div>
            </div>
        </div>
        
        <div class="user-list">
            <div class="user-list-header">
                <h3>Recent User Registrations</h3>
            </div>
            <div id="user-list-content">
                <div class="user-item">
                    <div class="user-info">
                        <div class="user-name">Loading users...</div>
                        <div class="user-details">Please wait</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="user-list email-queue">
            <div class="user-list-header">
                <h3>Email Automation Queue</h3>
            </div>
            <div id="email-queue-content">
                <div class="queue-item">
                    <div>Loading email queue...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="auth-system.js"></script>
    <script src="email-automation.js"></script>
    
    <script>
        function refreshDashboard() {
            updateUserStats();
            updateEmailStats();
            displayRecentUsers();
            displayEmailQueue();
        }
        
        function updateUserStats() {
            if (window.blogAuth) {
                const users = JSON.parse(localStorage.getItem('blog_users') || '[]');
                const totalUsers = users.length;
                const premiumUsers = users.filter(u => u.membershipTier !== 'free').length;
                const conversionRate = totalUsers > 0 ? ((premiumUsers / totalUsers) * 100).toFixed(1) : 0;
                
                document.getElementById('total-users').textContent = totalUsers;
                document.getElementById('premium-members').textContent = premiumUsers;
                document.getElementById('conversion-rate').textContent = conversionRate + '%';
            }
        }
        
        function updateEmailStats() {
            if (window.emailAutomation) {
                const subscriberStats = window.emailAutomation.getSubscriberStats();
                const emailStats = window.emailAutomation.getEmailStats();
                
                document.getElementById('active-subscribers').textContent = subscriberStats.activeSubscribers || 0;
                document.getElementById('emails-sent').textContent = emailStats.sentEmails || 0;
                document.getElementById('avg-engagement').textContent = subscriberStats.averageEngagement || 0;
            }
        }
        
        function displayRecentUsers() {
            const users = JSON.parse(localStorage.getItem('blog_users') || '[]');
            const recentUsers = users
                .sort((a, b) => new Date(b.registrationDate) - new Date(a.registrationDate))
                .slice(0, 10);
                
            const userListContent = document.getElementById('user-list-content');
            
            if (recentUsers.length === 0) {
                userListContent.innerHTML = `
                    <div class="user-item">
                        <div class="user-info">
                            <div class="user-name">No users yet</div>
                            <div class="user-details">Start by registering through the main blog</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            userListContent.innerHTML = recentUsers.map(user => `
                <div class="user-item">
                    <div class="user-info">
                        <div class="user-name">${user.firstName} ${user.lastName}</div>
                        <div class="user-details">
                            ${user.email} â€¢ ${user.company || 'No company'} â€¢ 
                            Registered: ${new Date(user.registrationDate).toLocaleDateString()}
                        </div>
                    </div>
                    <div class="membership-badge badge-${user.membershipTier}">
                        ${user.membershipTier}
                    </div>
                </div>
            `).join('');
        }
        
        function displayEmailQueue() {
            const emailQueue = JSON.parse(localStorage.getItem('email_queue') || '[]');
            const recentEmails = emailQueue
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 20);
                
            const emailQueueContent = document.getElementById('email-queue-content');
            
            if (recentEmails.length === 0) {
                emailQueueContent.innerHTML = `
                    <div class="queue-item">
                        <div>No emails in queue</div>
                    </div>
                `;
                return;
            }
            
            emailQueueContent.innerHTML = recentEmails.map(email => {
                const subscriber = JSON.parse(localStorage.getItem('email_subscribers') || '[]')
                    .find(s => s.id === email.subscriberId);
                const subscriberName = subscriber ? `${subscriber.firstName} ${subscriber.lastName}` : 'Unknown';
                
                return `
                    <div class="queue-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${email.template}</strong> to ${subscriberName}<br>
                                <small>Scheduled: ${new Date(email.scheduledFor).toLocaleString()}</small>
                            </div>
                            <span class="queue-status status-${email.status}">
                                ${email.status}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(refreshDashboard, 1000); // Wait for systems to initialize
        });
        
        // Auto-refresh every 30 seconds
        setInterval(refreshDashboard, 30000);
    </script>
</body>
</html>
